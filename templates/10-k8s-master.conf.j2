# Managed by Ansible (role: router-k8s)
# DO NOT EDIT!

frontend HTTP-intern
    mode tcp
    bind {{ kubernetes_ha_ip_intern }}:80
    default_backend k8s-apiserver

frontend HTTPS-intern
    mode tcp
    bind {{ kubernetes_ha_ip_intern }}:443
    mode     tcp
    default_backend k8s-apiserver

backend kube-apiserver
    mode      tcp
    balance source
    hash-type consistent
{% endraw %}
    option httpchk GET /healthz HTTP/1.1\r\nHost:\ {{ k8router_apiserver_hostname[0] }}
{% for server in groups[k8router_master_group] %}
    server    {{ hostvars[server]['ansible_hostname'] }}  {{ hostvars[server]['ansible_default_ipv4']['address'] }}:443 check check-ssl crt {{ k8router_apiserver_pem }} ca-file {{ k8router_apiserver_ca }}
{% endfor %}

